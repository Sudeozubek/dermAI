<!DOCTYPE html>
<html lang="tr" xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity6"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Blog - Cilt Sorunları ve Öneriler</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/layer.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/blog.css}">
    <link rel="stylesheet" th:href="@{/css/toast.css}">
</head>
<body>

<div th:replace="fragments/navbar :: navbar"></div>
<div th:replace="fragments/messages :: messages"></div>

<div class="main-content show">
    <div class="blog-container">
        <h1>Blog</h1>
        <section class="blog-share">
            <h2>Ne paylaşmak istersin?</h2>

            <sec:authorize access="isAuthenticated()">
                <form class="blog-form"
                      id="blogForm"
                      method="post"
                      th:action="@{/blog/posts}"
                      th:object="${postRequest}">

                    <div>
                        <label for="title">Başlık</label>
                        <input id="title"
                               placeholder="Başlık"
                               required
                               th:field="*{title}"
                               type="text"/>
                    </div>

                    <div>
                        <label for="content">İçerik</label>
                        <textarea id="content"
                                  placeholder="Cilt sorununu veya önerini yaz..."
                                  required
                                  rows="4"
                                  th:field="*{content}"></textarea>
                    </div>

                    <button id="submitPost" type="submit">Paylaş</button>
                </form>
            </sec:authorize>
        </section>

        <!-- Paylaşımlar -->
        <section class="blog-posts">
            <h2>Paylaşımlar</h2>

            <!-- Hiç post yoksa -->
            <div th:if="${posts.empty}">
                <p>Henüz paylaşım yok. İlk paylaşımı sen yap!</p>
            </div>

            <!-- Post listesi -->
            <div class="blog-post" th:each="post : ${posts.content}">
                <div class="post-header">
                    <span class="post-author" th:text="${post.authorUsername}">Yazar</span>
                    <span class="post-date"
                          th:text="${#temporals.format(post.createdAt, 'dd MMMM yyyy')}">
                    </span>
                </div>

                <div class="post-content">
                    <h3 th:text="${post.title}">Post Başlığı</h3>
                    <p th:text="${post.content}">Post içeriği buraya gelecek...</p>
                </div>

                <div class="post-actions">
                    <form class="inline-form"
                          method="post"
                          th:action="@{/blog/posts/{id}/reactions(id=${post.id})}">
                        <input name="type" type="hidden" value="LIKE"/>
                        <button type="submit">❤️ <span th:text="${post.likeCount}">0</span></button>
                    </form>
                    <form class="inline-form"
                          method="post"
                          th:action="@{/blog/posts/{id}/reactions(id=${post.id})}">
                        <input name="type" type="hidden" value="DISLIKE"/>
                        <button type="submit">👎 <span th:text="${post.dislikeCount}">0</span></button>
                    </form>
                </div>

                <!-- Yorumlar -->
                <div class="post-comments">
                    <div class="comment" th:each="cmt : ${post.comments}">
                        <span class="comment-author" th:text="${cmt.authorUsername}">Yorumcu</span>
                        <span class="comment-date"
                              th:text="${#temporals.format(cmt.createdAt, 'dd MMM yyyy HH:mm')}">
                        </span>
                        <p th:text="${cmt.content}">Yorum içeriği...</p>
                    </div>

                    <!-- Yeni yorum formu -->
                    <form class="comment-form"
                          method="post"
                          th:action="@{/blog/posts/{id}/comments(id=${post.id})}">
                        <input name="content"
                               placeholder="Yorumunuzu yazın"
                               required
                               type="text"/>
                        <button type="submit">Gönder</button>
                    </form>
                </div>

            </div>

            <!-- Sayfalama -->
            <div class="pagination"
                 th:if="${posts.totalPages > 1}">
                <a th:href="@{/blog(page=${posts.number-1},size=${posts.size})}"
                   th:if="${posts.hasPrevious()}">
                    « Geri
                </a>
                <span th:text="${posts.number + 1} + ' / ' + ${posts.totalPages}"></span>
                <a th:href="@{/blog(page=${posts.number+1},size=${posts.size})}"
                   th:if="${posts.hasNext()}">
                    İleri »
                </a>
            </div>
        </section>

    </div>
</div>

<div th:replace="fragments/footer :: footer"></div>

<script th:src="@{/js/toast.js}" defer></script>
<!--<script th:src="@{/js/app.js}"></script>-->

</body>
</html> 